<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>getData</title>
    <style>
        button {
            font-size: 34px;
        }
        iframe {
            width: 100%;
            height: 800px;
        }
        input {
            width: 200px;
            padding: 5px;
        }
    </style>
</head>
<body>
    <div>
        <a href="pm25.in" target="_blank">pm25.in</a>
        <a href="http://www.young-0.com/airquality/index.php" target="_blank">database</a>
        <a href="https://cn.avoscloud.com/applist.html#/apps" target="_blank">AVOS Console</a>
        <p><input type="text" class="first"></p>
        <p><input type="text" class="second"></p>
        <button class='save-guess'>Save the guess</button>
        <button class='fuck'>Get & Save the data</button>
        <p class="car"></p>
    </div>
    <hr>

    <script type="text/javascript" src="js/jquery.min.js"></script>
    <script type="text/javascript" src="js/av-0.3.1.min.js"></script>
    <script>
        AV.initialize("2uu9d14470rpv39bb1178vsddmkdfgis13zfr2be0vyeuog8", "o33s1rvaukqedeforme8f10wegjv69rdw0wjoei2cuka4u9q");

        $('.save-guess').on('click', function () {
            var first = $('.first').val();
            var second = $('.second').val();

            var father = AV.Object.extend('guess');
            var son = new father();
            son.set('first', first);
            son.set('second', second);
            son.save(null, {
              success: function(data) {
                $('.car').html('save guess success');
              },
              error: function(data, error) {
                $('.car').html('Failed to save guess info');
              }
            });
        });

        $('.fuck').on('click', function () {
            fuckData();
        });

        function fuckData () {
            var array = [];
            var domArray = $('#alonso').contents().find('.gr2');

            domArray.each(function (index, el) {
                array.unshift(parseInt($(el).text()));
            });

            var father = AV.Object.extend('aqiChart');
            var son = new father();

            son.set('data', array);

            son.save(null, {
                success: function(data) {
                    $('.car').html(array);
                },
                error: function(data, error) {
                    $('.car').html('Failed to create new object, with error code: ' + error.description);
                }
            });
        }

        function createIframe () {
            $('iframe').remove();
            var iframe = document.createElement('iframe');
            iframe.setAttribute('id', 'alonso');
            iframe.src = 'http://www.young-0.com/airquality/index.php?cn=1';
            iframe.onload = function(){
                fuckData();
            };
            document.body.appendChild(iframe);
        }

        setInterval(function () {
            createIframe();
        }, 600000);
    </script>
</body>
</html>